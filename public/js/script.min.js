/* Add class raw javascript */

function hasClass(ele,cls) {
    return !!ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function removeClass(element, className) {
    if (element && hasClass(element,className)) {
        var reg = new RegExp('(\\s|^)'+className+'(\\s|$)');
        element.className = ' ' + element.className.replace(reg,'') + ' ';
    }
}

function addClass(element, className) {
    if (element && !hasClass(element,className)) {
        element.className += '  '+ className + '  ';
    }
}

// Higher-order functions for Nodelists and full browser support
// https://toddmotto.com/ditch-the-array-foreach-call-nodelist-hack/#recommendations
// These functions are taken from the allmighty http://eloquentjavascript.net/05_higher_order.html
// Also they have been adapted to support the index value
function forEachNl(array, action) {
  for (var i = 0; i < array.length; i++)
    action(array[i], i);
}

function filterNl(array, test) {
  var passed = [];
  for (var i = 0; i < array.length; i++) {
    if (test(array[i], i))
      passed.push(array[i]);
  }
  return passed;
}

function mapNl(array, transform) {
  var mapped = [];
  for (var i = 0; i < array.length; i++)
    mapped.push(transform(array[i], i));
  return mapped;
}

function reduceNl(array, combine, start) {
  var current = start;
  for (var i = 0; i < array.length; i++)
    current = combine(current, array[i], i);
  return current;
}

function everyNl(array, predicate) {
  for (var i = 0; i < array.length; i++) {
    if (!predicate(array[i], i))
      return false;
  }
  return true;
}

function someNl(array, predicate) {
  for (var i = 0; i < array.length; i++) {
    if (predicate(array[i], i))
      return true;
  }
  return false;
}


function ajaxify(linkEl, callback) {
	document.querySelectorAll(linkEl).forEach(function(el) {
		var url = el.attributes.href.value;
		el.addEventListener('click', function(event) {
			event.preventDefault();

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
					if (xmlhttp.status == 200) {
						callback(xmlhttp.responseText);
					} else if (xmlhttp.status == 400) {
						console.log('There was an error 400');
					} else {
						console.log('something else other than 200 was returned');
						console.log(xmlhttp.responseText);
					}
				}
			};

			xmlhttp.open("GET", url, true);
			xmlhttp.send();
		}, false);
	});
}

function injectPartial(partialEl, containerEl, response) {
	var container = document.querySelector(containerEl);
	container.innerHTML = "";
	var doc = new DOMParser().parseFromString(response, 'text/html');
	var content = doc.documentElement.querySelector(partialEl);
	container.appendChild(content);
}

ajaxify('.event a', function(response){
	injectPartial('section.event', '.popup-content', response);
	addClass(document.querySelector('body'), 'popup-active');
});

ajaxify('a.post', function(response){
	injectPartial('article.post', '.popup-content', response);
	addClass(document.querySelector('body'), 'popup-active');
});

forEachNl(document.querySelectorAll('.close-popup, .popup-overlay'), function(el) {
	el.addEventListener('click', function(event) {
		removeClass(document.querySelector('body'), 'popup-active');
	}, false);
});

addClass(document.querySelector('.agenda'), 'interactive');

agendaIndex = 0;
months = document.querySelectorAll('.month');

document.querySelector('.controls .left').addEventListener('click', function(event) {
	if(agendaIndex > 0) {
		agendaIndex --;
		updateAgenda();
		updateTimeSelector();
	}
});

document.querySelector('.controls .right').addEventListener('click', function(event) {
	if(agendaIndex < months.length - 1) {
		agendaIndex ++;
		updateAgenda();
		updateTimeSelector();
	}
});

forEachNl(document.querySelectorAll('.time-selector label'), function(el, index) {
	el.addEventListener('click', function(event) {
		agendaIndex = index;
		updateAgenda();
	});
});

forEachNl(document.querySelectorAll('.filter label'), function(el, index) {
	el.addEventListener('click', function(event) {
		var checked = document.querySelectorAll('.filter input')[index].checked;
		filterAgenda(el.getAttribute('for'), checked);
		toggleEmptyMonthMessage();
	});
});

function updateAgenda() {
	forEachNl(months, function(el, index) {
		removeClass(el, 'toLeft');
		removeClass(el, 'toRight');
		removeClass(el, 'currentMonth');

		if(index < agendaIndex) {
			addClass(el, 'toLeft');
		} else if (index > agendaIndex) {
			addClass(el, 'toRight');
		}
	});

	addClass(months[agendaIndex], 'currentMonth');
}

function updateTimeSelector() {
	forEachNl(document.querySelectorAll('.time-selector input'), function(el, index){
		if(index === agendaIndex) {
			el.checked = true;
		}
	});
}

function filterAgenda(filter, toFilter) {
	var events = document.querySelectorAll('.event');

	var matchedEvents = filterNl(events, function(event){
		return hasClass(event, filter);
	});

	forEachNl(matchedEvents, function(event){
		if (toFilter) addClass(event, 'filtered');
		else removeClass(event, 'filtered');
	});
}

function toggleEmptyMonthMessage() {
	forEachNl(months, function(month){
		var eventsInMonth = month.querySelectorAll('.event');
		var alert = month.querySelector('.no-events-in-filter');

		var hasEvents = someNl(eventsInMonth, function(event){
			return !hasClass(event, 'filtered');
		});

		if (!hasEvents && eventsInMonth.length) {
			alert.innerText = 'Aucun évènement ne correspond à votre recherche ce mois-ci.';
			addClass(alert, 'show');
		} else if (hasEvents && eventsInMonth.length) {
			removeClass(alert, 'show');
		}

		console.log(month);
	});
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxpdGllcy5qcyIsImFqYXguanMiLCJhZ2VuZGEuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogQWRkIGNsYXNzIHJhdyBqYXZhc2NyaXB0ICovXG5cbmZ1bmN0aW9uIGhhc0NsYXNzKGVsZSxjbHMpIHtcbiAgICByZXR1cm4gISFlbGUuY2xhc3NOYW1lLm1hdGNoKG5ldyBSZWdFeHAoJyhcXFxcc3xeKScrY2xzKycoXFxcXHN8JCknKSk7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZUNsYXNzKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICAgIGlmIChlbGVtZW50ICYmIGhhc0NsYXNzKGVsZW1lbnQsY2xhc3NOYW1lKSkge1xuICAgICAgICB2YXIgcmVnID0gbmV3IFJlZ0V4cCgnKFxcXFxzfF4pJytjbGFzc05hbWUrJyhcXFxcc3wkKScpO1xuICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9ICcgJyArIGVsZW1lbnQuY2xhc3NOYW1lLnJlcGxhY2UocmVnLCcnKSArICcgJztcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGFkZENsYXNzKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICAgIGlmIChlbGVtZW50ICYmICFoYXNDbGFzcyhlbGVtZW50LGNsYXNzTmFtZSkpIHtcbiAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgKz0gJyAgJysgY2xhc3NOYW1lICsgJyAgJztcbiAgICB9XG59XG5cbi8vIEhpZ2hlci1vcmRlciBmdW5jdGlvbnMgZm9yIE5vZGVsaXN0cyBhbmQgZnVsbCBicm93c2VyIHN1cHBvcnRcbi8vIGh0dHBzOi8vdG9kZG1vdHRvLmNvbS9kaXRjaC10aGUtYXJyYXktZm9yZWFjaC1jYWxsLW5vZGVsaXN0LWhhY2svI3JlY29tbWVuZGF0aW9uc1xuLy8gVGhlc2UgZnVuY3Rpb25zIGFyZSB0YWtlbiBmcm9tIHRoZSBhbGxtaWdodHkgaHR0cDovL2Vsb3F1ZW50amF2YXNjcmlwdC5uZXQvMDVfaGlnaGVyX29yZGVyLmh0bWxcbi8vIEFsc28gdGhleSBoYXZlIGJlZW4gYWRhcHRlZCB0byBzdXBwb3J0IHRoZSBpbmRleCB2YWx1ZVxuZnVuY3Rpb24gZm9yRWFjaE5sKGFycmF5LCBhY3Rpb24pIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKylcbiAgICBhY3Rpb24oYXJyYXlbaV0sIGkpO1xufVxuXG5mdW5jdGlvbiBmaWx0ZXJObChhcnJheSwgdGVzdCkge1xuICB2YXIgcGFzc2VkID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAodGVzdChhcnJheVtpXSwgaSkpXG4gICAgICBwYXNzZWQucHVzaChhcnJheVtpXSk7XG4gIH1cbiAgcmV0dXJuIHBhc3NlZDtcbn1cblxuZnVuY3Rpb24gbWFwTmwoYXJyYXksIHRyYW5zZm9ybSkge1xuICB2YXIgbWFwcGVkID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspXG4gICAgbWFwcGVkLnB1c2godHJhbnNmb3JtKGFycmF5W2ldLCBpKSk7XG4gIHJldHVybiBtYXBwZWQ7XG59XG5cbmZ1bmN0aW9uIHJlZHVjZU5sKGFycmF5LCBjb21iaW5lLCBzdGFydCkge1xuICB2YXIgY3VycmVudCA9IHN0YXJ0O1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKVxuICAgIGN1cnJlbnQgPSBjb21iaW5lKGN1cnJlbnQsIGFycmF5W2ldLCBpKTtcbiAgcmV0dXJuIGN1cnJlbnQ7XG59XG5cbmZ1bmN0aW9uIGV2ZXJ5TmwoYXJyYXksIHByZWRpY2F0ZSkge1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKCFwcmVkaWNhdGUoYXJyYXlbaV0sIGkpKVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBzb21lTmwoYXJyYXksIHByZWRpY2F0ZSkge1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHByZWRpY2F0ZShhcnJheVtpXSwgaSkpXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59IiwiXG5cbmZ1bmN0aW9uIGFqYXhpZnkobGlua0VsLCBjYWxsYmFjaykge1xuXHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGxpbmtFbCkuZm9yRWFjaChmdW5jdGlvbihlbCkge1xuXHRcdHZhciB1cmwgPSBlbC5hdHRyaWJ1dGVzLmhyZWYudmFsdWU7XG5cdFx0ZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuXHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0dmFyIHhtbGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuXHRcdFx0eG1saHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKHhtbGh0dHAucmVhZHlTdGF0ZSA9PSBYTUxIdHRwUmVxdWVzdC5ET05FICkge1xuXHRcdFx0XHRcdGlmICh4bWxodHRwLnN0YXR1cyA9PSAyMDApIHtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKHhtbGh0dHAucmVzcG9uc2VUZXh0KTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHhtbGh0dHAuc3RhdHVzID09IDQwMCkge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coJ1RoZXJlIHdhcyBhbiBlcnJvciA0MDAnKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coJ3NvbWV0aGluZyBlbHNlIG90aGVyIHRoYW4gMjAwIHdhcyByZXR1cm5lZCcpO1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coeG1saHR0cC5yZXNwb25zZVRleHQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0eG1saHR0cC5vcGVuKFwiR0VUXCIsIHVybCwgdHJ1ZSk7XG5cdFx0XHR4bWxodHRwLnNlbmQoKTtcblx0XHR9LCBmYWxzZSk7XG5cdH0pO1xufVxuXG5mdW5jdGlvbiBpbmplY3RQYXJ0aWFsKHBhcnRpYWxFbCwgY29udGFpbmVyRWwsIHJlc3BvbnNlKSB7XG5cdHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckVsKTtcblx0Y29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XG5cdHZhciBkb2MgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKHJlc3BvbnNlLCAndGV4dC9odG1sJyk7XG5cdHZhciBjb250ZW50ID0gZG9jLmRvY3VtZW50RWxlbWVudC5xdWVyeVNlbGVjdG9yKHBhcnRpYWxFbCk7XG5cdGNvbnRhaW5lci5hcHBlbmRDaGlsZChjb250ZW50KTtcbn1cblxuYWpheGlmeSgnLmV2ZW50IGEnLCBmdW5jdGlvbihyZXNwb25zZSl7XG5cdGluamVjdFBhcnRpYWwoJ3NlY3Rpb24uZXZlbnQnLCAnLnBvcHVwLWNvbnRlbnQnLCByZXNwb25zZSk7XG5cdGFkZENsYXNzKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKSwgJ3BvcHVwLWFjdGl2ZScpO1xufSk7XG5cbmFqYXhpZnkoJ2EucG9zdCcsIGZ1bmN0aW9uKHJlc3BvbnNlKXtcblx0aW5qZWN0UGFydGlhbCgnYXJ0aWNsZS5wb3N0JywgJy5wb3B1cC1jb250ZW50JywgcmVzcG9uc2UpO1xuXHRhZGRDbGFzcyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5JyksICdwb3B1cC1hY3RpdmUnKTtcbn0pO1xuXG5mb3JFYWNoTmwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNsb3NlLXBvcHVwLCAucG9wdXAtb3ZlcmxheScpLCBmdW5jdGlvbihlbCkge1xuXHRlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG5cdFx0cmVtb3ZlQ2xhc3MoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLCAncG9wdXAtYWN0aXZlJyk7XG5cdH0sIGZhbHNlKTtcbn0pOyIsIlxuYWRkQ2xhc3MoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFnZW5kYScpLCAnaW50ZXJhY3RpdmUnKTtcblxuYWdlbmRhSW5kZXggPSAwO1xubW9udGhzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vbnRoJyk7XG5cbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cm9scyAubGVmdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcblx0aWYoYWdlbmRhSW5kZXggPiAwKSB7XG5cdFx0YWdlbmRhSW5kZXggLS07XG5cdFx0dXBkYXRlQWdlbmRhKCk7XG5cdFx0dXBkYXRlVGltZVNlbGVjdG9yKCk7XG5cdH1cbn0pO1xuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJvbHMgLnJpZ2h0JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuXHRpZihhZ2VuZGFJbmRleCA8IG1vbnRocy5sZW5ndGggLSAxKSB7XG5cdFx0YWdlbmRhSW5kZXggKys7XG5cdFx0dXBkYXRlQWdlbmRhKCk7XG5cdFx0dXBkYXRlVGltZVNlbGVjdG9yKCk7XG5cdH1cbn0pO1xuXG5mb3JFYWNoTmwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRpbWUtc2VsZWN0b3IgbGFiZWwnKSwgZnVuY3Rpb24oZWwsIGluZGV4KSB7XG5cdGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRhZ2VuZGFJbmRleCA9IGluZGV4O1xuXHRcdHVwZGF0ZUFnZW5kYSgpO1xuXHR9KTtcbn0pO1xuXG5mb3JFYWNoTmwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpbHRlciBsYWJlbCcpLCBmdW5jdGlvbihlbCwgaW5kZXgpIHtcblx0ZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuXHRcdHZhciBjaGVja2VkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpbHRlciBpbnB1dCcpW2luZGV4XS5jaGVja2VkO1xuXHRcdGZpbHRlckFnZW5kYShlbC5nZXRBdHRyaWJ1dGUoJ2ZvcicpLCBjaGVja2VkKTtcblx0XHR0b2dnbGVFbXB0eU1vbnRoTWVzc2FnZSgpO1xuXHR9KTtcbn0pO1xuXG5mdW5jdGlvbiB1cGRhdGVBZ2VuZGEoKSB7XG5cdGZvckVhY2hObChtb250aHMsIGZ1bmN0aW9uKGVsLCBpbmRleCkge1xuXHRcdHJlbW92ZUNsYXNzKGVsLCAndG9MZWZ0Jyk7XG5cdFx0cmVtb3ZlQ2xhc3MoZWwsICd0b1JpZ2h0Jyk7XG5cdFx0cmVtb3ZlQ2xhc3MoZWwsICdjdXJyZW50TW9udGgnKTtcblxuXHRcdGlmKGluZGV4IDwgYWdlbmRhSW5kZXgpIHtcblx0XHRcdGFkZENsYXNzKGVsLCAndG9MZWZ0Jyk7XG5cdFx0fSBlbHNlIGlmIChpbmRleCA+IGFnZW5kYUluZGV4KSB7XG5cdFx0XHRhZGRDbGFzcyhlbCwgJ3RvUmlnaHQnKTtcblx0XHR9XG5cdH0pO1xuXG5cdGFkZENsYXNzKG1vbnRoc1thZ2VuZGFJbmRleF0sICdjdXJyZW50TW9udGgnKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlVGltZVNlbGVjdG9yKCkge1xuXHRmb3JFYWNoTmwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRpbWUtc2VsZWN0b3IgaW5wdXQnKSwgZnVuY3Rpb24oZWwsIGluZGV4KXtcblx0XHRpZihpbmRleCA9PT0gYWdlbmRhSW5kZXgpIHtcblx0XHRcdGVsLmNoZWNrZWQgPSB0cnVlO1xuXHRcdH1cblx0fSk7XG59XG5cbmZ1bmN0aW9uIGZpbHRlckFnZW5kYShmaWx0ZXIsIHRvRmlsdGVyKSB7XG5cdHZhciBldmVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZXZlbnQnKTtcblxuXHR2YXIgbWF0Y2hlZEV2ZW50cyA9IGZpbHRlck5sKGV2ZW50cywgZnVuY3Rpb24oZXZlbnQpe1xuXHRcdHJldHVybiBoYXNDbGFzcyhldmVudCwgZmlsdGVyKTtcblx0fSk7XG5cblx0Zm9yRWFjaE5sKG1hdGNoZWRFdmVudHMsIGZ1bmN0aW9uKGV2ZW50KXtcblx0XHRpZiAodG9GaWx0ZXIpIGFkZENsYXNzKGV2ZW50LCAnZmlsdGVyZWQnKTtcblx0XHRlbHNlIHJlbW92ZUNsYXNzKGV2ZW50LCAnZmlsdGVyZWQnKTtcblx0fSk7XG59XG5cbmZ1bmN0aW9uIHRvZ2dsZUVtcHR5TW9udGhNZXNzYWdlKCkge1xuXHRmb3JFYWNoTmwobW9udGhzLCBmdW5jdGlvbihtb250aCl7XG5cdFx0dmFyIGV2ZW50c0luTW9udGggPSBtb250aC5xdWVyeVNlbGVjdG9yQWxsKCcuZXZlbnQnKTtcblx0XHR2YXIgYWxlcnQgPSBtb250aC5xdWVyeVNlbGVjdG9yKCcubm8tZXZlbnRzLWluLWZpbHRlcicpO1xuXG5cdFx0dmFyIGhhc0V2ZW50cyA9IHNvbWVObChldmVudHNJbk1vbnRoLCBmdW5jdGlvbihldmVudCl7XG5cdFx0XHRyZXR1cm4gIWhhc0NsYXNzKGV2ZW50LCAnZmlsdGVyZWQnKTtcblx0XHR9KTtcblxuXHRcdGlmICghaGFzRXZlbnRzICYmIGV2ZW50c0luTW9udGgubGVuZ3RoKSB7XG5cdFx0XHRhbGVydC5pbm5lclRleHQgPSAnQXVjdW4gw6l2w6huZW1lbnQgbmUgY29ycmVzcG9uZCDDoCB2b3RyZSByZWNoZXJjaGUgY2UgbW9pcy1jaS4nO1xuXHRcdFx0YWRkQ2xhc3MoYWxlcnQsICdzaG93Jyk7XG5cdFx0fSBlbHNlIGlmIChoYXNFdmVudHMgJiYgZXZlbnRzSW5Nb250aC5sZW5ndGgpIHtcblx0XHRcdHJlbW92ZUNsYXNzKGFsZXJ0LCAnc2hvdycpO1xuXHRcdH1cblxuXHRcdGNvbnNvbGUubG9nKG1vbnRoKTtcblx0fSk7XG59Il19
